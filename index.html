<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סיפורי שימי</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to the external stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- All custom styles have been moved to style.css -->
</head>
<body>
    <div class="container">
        <!-- Home Page Section -->
        <div id="homePageSection" class="home-page-section">
            <div class="home-content-row">
                <div>
                    <h2>ברוכים הבאים לסיפורי שימי!</h2>
                </div>
                <img src="https://placehold.co/300x200/facc15/1e3a8a?text=Shimi+Stories" alt="Home Page Image" class="home-page-image">
            </div>
            <button id="goToDispenserBtn" class="home-button">
                התחל סיפורים!
            </button>
        </div>

        <!-- Phrase Dispenser Section (Initially Hidden) -->
        <div id="phraseDispenserSection" class="phrase-dispenser-section">

            <div class="content-wrapper">
                <div id="phraseDisplay" class="phrase-display">
                    <!-- Initial phrase or prompt will be loaded here by JavaScript -->
                </div>
                <!-- Image loader element -->
                <img id="imageLoader" src="your-image-name.gif" alt="Loading Spinner" class="image-loader">
                <!-- IMPORTANT: Replace "your-image-name.gif" with the actual filename of your image -->
            </div>

            <button id="choosePhraseBtn" class="choose-button">
                !תביא סיפור
            </button>
        </div>
    </div>

    <!-- Import the phrases from a separate file -->
    <script src="phrases.js"></script>
    <script>
        // Get references to the HTML elements
        const homePageSection = document.getElementById('homePageSection');
        const phraseDispenserSection = document.getElementById('phraseDispenserSection');
        const goToDispenserBtn = document.getElementById('goToDispenserBtn');

        const choosePhraseBtn = document.getElementById('choosePhraseBtn');
        const phraseDisplay = document.getElementById('phraseDisplay');
        const imageLoader = document.getElementById('imageLoader'); // Reference to the image loader

        // Array to keep track of indices of phrases that have already been displayed
        let displayedPhraseIndices = [];

        // Function to display a random phrase and its URL
        function displayRandomPhrase() {
            // Hide phrase content
            phraseDisplay.style.display = 'none';

            // Add 'spinning' class to start animation
            imageLoader.classList.add('spinning');

            // Simulate loading time for 2 seconds
            setTimeout(() => {
                // Remove 'spinning' class to stop animation
                imageLoader.classList.remove('spinning');

                // Show phrase content
                phraseDisplay.style.display = 'flex'; // Restore display for phrase

                // If all phrases have been displayed, reset the array to start a new cycle
                if (displayedPhraseIndices.length === phrases.length) {
                    displayedPhraseIndices = []; // Reset the stack
                    console.log("All phrases displayed. Resetting stack."); // Optional: log to console
                }

                let randomIndex;
                let randomPhraseObject;
                let isDuplicate;

                // Loop until a unique phrase (index not yet displayed) is found
                do {
                    randomIndex = Math.floor(Math.random() * phrases.length);
                    randomPhraseObject = phrases[randomIndex];
                    isDuplicate = displayedPhraseIndices.includes(randomIndex);
                } while (isDuplicate);

                // Add the chosen unique index to the list of displayed phrases
                displayedPhraseIndices.push(randomIndex);

                // Clear previous content
                phraseDisplay.innerHTML = '';

                // Check if the phrase object has a URL
                if (randomPhraseObject.url) {
                    // Create a clickable link for the phrase/title
                    const phraseLink = document.createElement('a');
                    phraseLink.href = randomPhraseObject.url;
                    phraseLink.textContent = randomPhraseObject.phrase;
                    phraseLink.target = "_blank"; // Open link in a new tab
                    phraseLink.classList.add('phrase-link'); // Add a class for styling if needed
                    phraseDisplay.appendChild(phraseLink);
                } else {
                    // If no URL, just display the phrase as text
                    phraseDisplay.textContent = randomPhraseObject.phrase;
                }

            }, 2000); // 2000 milliseconds = 2 seconds
        }

        // Event listener for the "Go to Dispenser" button
        goToDispenserBtn.addEventListener('click', () => {
            homePageSection.style.display = 'none'; // Hide home page
            phraseDispenserSection.style.display = 'block'; // Show phrase dispenser
            displayRandomPhrase(); // Load the first phrase immediately
        });

        // Add an event listener to the "Choose Phrase" button (inside phrase dispenser)
        choosePhraseBtn.addEventListener('click', displayRandomPhrase);

        // Initial setup: Show home page, hide phrase dispenser
        document.addEventListener('DOMContentLoaded', () => {
            homePageSection.style.display = 'flex'; // Ensure home page is visible
            phraseDispenserSection.style.display = 'none'; // Hide phrase dispenser
            // No initial phrase display on load, as we are on the home page
        });
    </script>
</body>
</html>
